{
    "$schema": "http://json-schema.org/draft-04/schema#",

	"definitions": {
        "changegroup": {
            "oneOf": [{
                "additionalProperties": true,
                "required": ["changegroupsAscending"],
                "properties": {
                    "forecast": {"$ref": "#/definitions/forecast"},
	                "cloudsCBorTCUNeededAndPresent": {
	    			    "type": "boolean",
	                	"enum": [true],
	                    "$geoweb::messages": {
	                		"enum": "When there are showers, a CB or TCU cloud is required"
	                    }
	    			},
	    			"cloudsCBNeededAndPresent": {
	    			    "type": "boolean",
	                	"enum": [true],
	                    "$geoweb::messages": {
	                		"enum": "When there are thunderstorms, a CB cloud is required"
	                    }
	    			},
                    
                    "changegroupsAscending": {
                        "type": "boolean",
                        "enum": [true],
                        "$geoweb::messages": {
                            "enum": "Changegroups must be ascending in starting time"
                     	}
                    },
                    "repeatingChange": {
                        "type": "boolean",
                        "enum": [false],
                        "$geoweb::messages": {
                            "enum": "A change in a changegroup must be unique"
                     	}
                    },
                    "changeType": {
                    	"type": "string",
                    	"enum": ["PROB30", "TEMPO", "FM", "PROB40", "PROB30 TEMPO", "PROB40 TEMPO"]
                    },
                    "changeDurationInHours": {
                        "type": "integer", 
                        "minimum": 1,
                        "maximum": 30,
						"$geoweb::messages": {
                            "minimum": "Changegroup must last at least one hour",
                            "maximum": "Changegroup can't last all day"
                     	}
                    },
                    "cloudsNeededAndPresent":{
                    	"type": "boolean",
                    	"enum": [false],
                        "$geoweb::messages": {
                    		"enum": "Clouds are necessary for rain"
                        }
                    },
                    "endAfterStart": {
                    	"type": "boolean",
                    	"enum": [true],
                    	"$geoweb::messages": {
                    		"enum": "The end of the change must be after the start"
                    	}
                    },
                    "visibilityWeatherRequiredAndPresent": {
                    	"type": "boolean",
                    	"enum": [true],
                    	"$geoweb::messages": {
                    		"enum": "If the visibility is less than 5000 meters weather groups are required"
                    	}
                    },
                    "windEnoughDifference": {
                    	"type": "boolean",
                    	"enum": [true],
                    	"$geoweb::messages": {
                    		"enum": "Change in wind must be at least 30 degrees or 5 knots"
                    	}
                    }
                }  
            }, {
                "additionalProperties": true,
                "required": ["changegroupsAscending", "changegroupBecomingOverlaps", "changeType", "changeDurationInHours"],
                "properties": {
                    "forecast": {"$ref": "#/definitions/forecast"},
	    			"cloudsCBorTCUNeededAndPresent": {
	    			    "type": "boolean",
	                	"enum": [true],
	                    "$geoweb::messages": {
	                		"enum": "When there are showers, a CB or TCU cloud is required"
	                    }
	    			},
	    			"cloudsCBNeededAndPresent": {
	    			    "type": "boolean",
	                	"enum": [true],
	                    "$geoweb::messages": {
	                		"enum": "When there are thunderstorms, a CB cloud is required"
	                    }
	    			},

                    "changegroupsAscending": {
                        "type": "boolean",
                        "enum": [true],
                        "$geoweb::messages": {
                            "enum": "Changegroups must be ascending in starting time"
                     	}
                    },
					"repeatingChange": {
                        "type": "boolean",
                        "enum": [false],
                        "$geoweb::messages": {
                            "enum": "A change in a changegroup must be unique"
                     	}
                    },
                    "cloudsNeededAndPresent":{
                    	"type": "boolean",
                    	"enum": [true],
                        "$geoweb::messages": {
                    		"enum": "Clouds are necessary for rain"
                        }
                    },
                    "changegroupBecomingOverlaps": {
                        "type": "boolean",
                        "enum": [false],
                        "$geoweb::messages": {
                            "enum": "BECMG changegroups cannot overlap"
                     	}
                    },
                    "changeType": {
                        "type": "string", 
                        "enum": ["BECMG"]
                    },
                    "changeDurationInHours": {
                        "type": "integer", 
                        "minimum": 1,
                        "maximum": 4,
                        "$geoweb::messages": {
                            "minimum": "Changegroups must be at least one hour",
                            "maximum": "BECMG changegroups should be shorter than 2 hours, but strictly shorter than 4 hours"
                     	}
                    },
                    "endAfterStart": {
                    	"type": "boolean",
                    	"enum": [true],
                    	"$geoweb::messages": {
                    		"enum": "The end of the change must be after the start"
                    	}
                    },
                    "visibilityWeatherRequiredAndPresent": {
                    	"type": "boolean",
                    	"enum": [true],
                    	"$geoweb::messages": {
                    		"enum": "If the visibility is less than 5000 meters weather groups are required"
                    	}
                    },
                    "windEnoughDifference": {
                    	"type": "boolean",
                    	"enum": [true],
                    	"$geoweb::messages": {
                    		"enum": "Change in wind must be at least 30 degrees or 5 knots"
                    	}
                    }
                }
			}
            ]
        },
		"forecast": {
    		"type": "object",
    		"properties": {
    			"cloudsCBorTCUNeededAndPresent": {
    			    "type": "boolean",
                	"enum": [true],
                    "$geoweb::messages": {
                		"enum": "When there are showers, a CB or TCU cloud is required"
                    }
    			},
    			"cloudsCBNeededAndPresent": {
    			    "type": "boolean",
                	"enum": [true],
                    "$geoweb::messages": {
                		"enum": "When there are thunderstorms, a CB cloud is required"
                    }
    			},
    			"visibilityWeatherRequiredAndPresent": {
                	"type": "boolean",
                	"enum": [true],
                	"$geoweb::messages": {
                		"enum": "If the visibility is less than 5000 meters weather groups are required"
                	}
                },
                "cloudsModifierHasWeatherPresent": {
                    "type": "boolean",
                	"enum": [true],
                    "$geoweb::messages": {
                		"enum": "In the presence of CB or TCU a weather group with SH or TS is required"
                    }
                },
                "cloudsNeededAndPresent":{
                	"type": "boolean",
                	"enum": [true],
                    "$geoweb::messages": {
                		"enum": "Clouds are necessary for rain"
                    }
                },
                "cloudsAscending": {
                    "type": "boolean",
                    "enum": [true],
                    "$geoweb::messages": {
                        "enum": "Cloud groups must be ascending in height"
                 	}
                },
                "visibilityWithinLimit": {
                    "type": "boolean",
                    "enum": [true],
                    "$geoweb::messages": {
                        "enum": "The current combination of weather group and visibility is invalid."
                 	}
                },
    			"wind": {
    				"type": "object",
                    "oneOf": [{
        				"properties": {
        					"gustFastEnough": {
        						"type": "boolean",
        						"enum": [true],
        						"$geoweb::messages": {
		                            "enum": "Wind gusts must at least be 10 knots greater than the wind speed"
		                     	}
        					},
                            "gusts": {
                                "type": "integer"
                            },
                            "speed": {
                                "type": "integer"
                            },
                            "direction": {
                                "oneOf": [{"type": "integer"}, {"type": "string"}]
                            },
                            "unit": {
                                "type": "string"
                            }
        				},
        				"additionalProperties": false,
        				"required": ["gustFastEnough", "gusts"]
                    }, {
                        "properties": {
                            "gustFastEnough": {
                                "type": "boolean",
                                "enum": [true]
                            },
                            "speed": {
                                "type": "integer"
                            },
                            "direction": {
                                "oneOf": [{"type": "integer"}, {"type": "string"}]
                            },
                            "unit": {
                                "type": "string"
                            }
                        },
                        "additionalProperties": false
                    }]
                }
    		},
            "additionalProperties": true
    	}
	},
    "type": "object",
    "properties":
    {
    	"forecast": {"$ref": "#/definitions/forecast"},
        "changegroups": {
            "type": "array",
            "minItems": 0,
            "maxItems": 10,
            "items": [{"$ref": "#/definitions/changegroup"},{"$ref": "#/definitions/changegroup"},{"$ref": "#/definitions/changegroup"},{"$ref": "#/definitions/changegroup"},{"$ref": "#/definitions/changegroup"},{"$ref": "#/definitions/changegroup"},{"$ref": "#/definitions/changegroup"},{"$ref": "#/definitions/changegroup"},{"$ref": "#/definitions/changegroup"},{"$ref": "#/definitions/changegroup"}],
            "additionalProperties": false
        }
	}
}
